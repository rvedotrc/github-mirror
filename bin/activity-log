#!/usr/bin/env ruby

require 'json'
require 'time'

def do_permutation(entry, permutation, is_added)
  t = entry["commit"]["time"]["iso"]
  org = entry["local_dir"]["github"]["organisation"]
  repo = entry["local_dir"]["github"]["repository"]
  file = entry["file"]["filename"]

  access, secret = permutation

  puts "#{is_added ? "+" : "-"} #{t} #{access} #{secret} #{org}/#{repo}/#{file}"
end

data = JSON.parse(IO.read "var/commits-and-secrets.json")

data.each do |entry|
  entry["old_permutations"].each do |p|
    do_permutation entry, p, false
  end

  entry["new_permutations"].each do |p|
    do_permutation entry, p, true
  end
end
