#!/usr/bin/env ruby

try_keys, account_list = ARGV
try_keys ||= "try-keys.json"
account_list ||= "aws-accounts.json"

require 'json'
t = JSON.parse(IO.read try_keys)
a = JSON.parse(IO.read account_list)

t["by_access_key"].values.each do |ki|
  if ki["user_arn"]
    account_id = ki["user_arn"].split(/:/)[4]
    account_info = a["accounts"].find {|acc| acc["account_id"] == account_id}
    ki["account_info"] = account_info
  end
end

puts JSON.pretty_generate(t)
