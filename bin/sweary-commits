#!/usr/bin/env ruby

$: << "lib"
require 'github_mirror'

c = []

GithubMirror::JsonCache.new("var/fast-run.json", 1E9).read.each do |r|
  r["sweary_commits"] or next
  log = r["sweary_commits"]["log"]
  if log and !log.empty?
    log = log.map {|l| {git_url: r["git_url"]}.merge log_entry: l}
    c.concat log
  end
end

c.uniq! {|l| l[:log_entry].first}

c.sort_by! do |l|
  l[:log_entry].find {|t| t.start_with? "Date:"}
end

puts JSON.generate(c)
